<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Zombies & Challenges Record Keeper</title>
  <style>
    :root {
      --bg: #0f1115;
      --panel: #151924;
      --panel-2: #1b2130;
      --text: #e7eaf0;
      --muted: #9aa3b2;
      --acc: #66e3ff;
      --accent-2: #9d87ff;
      --ok: #2ecc71;
      --warn: #f1c40f;
      --danger: #e74c3c;
      --radius: 14px;
    }
    * { box-sizing: border-box; }
    body { margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji"; background: linear-gradient(180deg, #0e1014, #0f1115 140px); color: var(--text); }
    header { position: sticky; top: 0; z-index: 10; backdrop-filter: blur(6px); background: rgba(15,17,21,0.8); border-bottom: 1px solid #202635; }
    .wrap { max-width: 1200px; margin: 0 auto; padding: 16px 20px; }
    h1 { margin: 6px 0 2px; font-size: 22px; letter-spacing: 0.3px; }
    header p { margin: 0; color: var(--muted); font-size: 13px; }

    .grid { display: grid; grid-template-columns: 320px 1fr; gap: 16px; align-items: start; }
    @media (max-width: 980px){ .grid{ grid-template-columns: 1fr; } }

    .card { background: linear-gradient(180deg, var(--panel), var(--panel-2)); border: 1px solid #222a3d; border-radius: var(--radius); box-shadow: 0 6px 24px rgba(0,0,0,0.35), inset 0 1px 0 rgba(255,255,255,0.03); }
    .card h2 { margin: 0 0 8px; font-size: 16px; letter-spacing: 0.3px; }
    .card .body { padding: 16px; }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .row-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }
    label { font-size: 12px; color: var(--muted); display: block; margin-bottom: 6px; }
    select, input, textarea { width: 100%; padding: 10px 12px; border-radius: 10px; border: 1px solid #2a344b; background: #0f1320; color: var(--text); outline: none; }
    textarea { min-height: 64px; resize: vertical; }
    .hint { font-size: 11px; color: var(--muted); margin-top: 4px; }

    .btn { display: inline-flex; align-items: center; gap: 8px; padding: 10px 14px; border: 1px solid #2a344b; background: #12182a; color: var(--text); border-radius: 10px; cursor: pointer; text-decoration: none; font-weight: 600; }
    .btn:hover { border-color: #34405a; box-shadow: 0 0 0 3px rgba(153,132,255,0.15); }
    .btn.primary { background: linear-gradient(180deg, #2a255b, #211c46); border-color: #3b2fa6; }
    .btn.success { background: linear-gradient(180deg, #1f5933, #153d24); border-color: #21764a; }
    .btn.warn { background: linear-gradient(180deg, #6f4f10, #3f2c08); border-color: #9b6b13; }
    .btn.ghost { background: transparent; }

    .toolbar { display: flex; flex-wrap: wrap; gap: 8px; align-items: center; }
    .toolbar .spacer { flex: 1; }

    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 10px 12px; border-bottom: 1px solid #222a3d; font-size: 13px; }
    th { text-align: left; color: var(--muted); user-select: none; cursor: pointer; white-space: nowrap; }
    tr:hover td { background: rgba(157, 135, 255, 0.06); }
    .chip { display: inline-flex; align-items: center; padding: 2px 8px; border-radius: 999px; border: 1px solid #324064; font-size: 12px; color: #c7d2ff; }

    .filters { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
    @media (max-width: 800px){ .filters{ grid-template-columns: repeat(2,1fr);} }

    .subtle { color: var(--muted); font-size: 12px; }
    .empty { text-align: center; color: var(--muted); padding: 24px; border: 1px dashed #2a344b; border-radius: 12px; }

    .kbd { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size: 12px; background: #0c0f18; border: 1px solid #2a344b; padding: 2px 6px; border-radius: 6px; }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>Zombies & Challenges Record Keeper</h1>
      <p>Track attempts and world-firsts across players, maps, and challenges. Data is stored locally in your browser.</p>
    </div>
  </header>

  <main class="wrap">
    <div class="grid">
      <!-- INPUT PANEL -->
      <section class="card" aria-labelledby="form-title">
        <div class="body">
          <h2 id="form-title">Add / Edit Record</h2>
          <form id="record-form">
            <div class="row">
              <div>
                <label for="player">Player</label>
                <select id="player" required></select>
              </div>
              <div>
                <label for="date">Date</label>
                <input id="date" type="date" />
              </div>
            </div>

            <div class="row">
              <div>
                <label for="map">Map</label>
                <select id="map" required></select>
              </div>
              <div>
                <label for="challenge">Challenge</label>
                <select id="challenge" required></select>
              </div>
            </div>

            <div class="row-3">
              <div>
                <label for="round">Round Reached</label>
                <input id="round" type="number" min="0" placeholder="e.g., 42" />
              </div>
              <div>
                <label for="time">Time (mm:ss or hh:mm:ss)</label>
                <input id="time" type="text" placeholder="e.g., 58:37" />
              </div>
              <div>
                <label for="downs">Downs</label>
                <input id="downs" type="number" min="0" placeholder="0" />
              </div>
            </div>

            <div class="row">
              <div>
                <label for="score">Score</label>
                <input id="score" type="number" min="0" placeholder="optional" />
              </div>
              <div>
                <label for="proof">Proof / Link</label>
                <input id="proof" type="url" placeholder="https://…" />
              </div>
            </div>

            <div>
              <label for="notes">Notes</label>
              <textarea id="notes" placeholder="strat, loadout, modifiers…"></textarea>
            </div>

            <div class="toolbar" style="margin-top:12px">
              <button class="btn primary" type="submit">Save Record</button>
              <button class="btn ghost" type="button" id="reset-btn">Reset Form</button>
              <span class="spacer"></span>
              <button class="btn" type="button" id="export-btn">Export JSON</button>
              <label class="btn" for="import-file" title="Import JSON">Import JSON<input id="import-file" type="file" accept="application/json" style="display:none" /></label>
            </div>
            <p class="hint">Sorting tie-breakers: higher <span class="kbd">Round</span> wins; if tied, shorter <span class="kbd">Time</span> wins; then fewer <span class="kbd">Downs</span>.</p>
          </form>
        </div>
      </section>

      <!-- TABLE PANEL -->
      <section class="card" aria-labelledby="table-title">
        <div class="body">
          <div class="toolbar" style="margin-bottom:10px">
            <h2 id="table-title" style="margin:0">Records</h2>
            <span class="spacer"></span>
            <input id="search" type="search" placeholder="Search notes / proof…" style="max-width:260px" />
          </div>

          <div class="filters" style="margin-bottom:10px">
            <select id="filter-map"><option value="">All Maps</option></select>
            <select id="filter-challenge"><option value="">All Challenges</option></select>
            <select id="filter-player"><option value="">All Players</option></select>
            <select id="filter-sort">
              <option value="best">Sort: Best (Round⇣, Time⇡, Downs⇡)</option>
              <option value="recent">Sort: Most Recent</option>
              <option value="round">Sort: Round Only</option>
              <option value="time">Sort: Fastest Time</option>
            </select>
          </div>

          <div class="toolbar" style="margin-bottom:6px">
            <span class="subtle" id="count">0 results</span>
            <span class="spacer"></span>
            <button class="btn warn" id="wipe-btn" title="Erase all records"><span>Wipe All</span></button>
          </div>

          <div style="overflow:auto; border:1px solid #222a3d; border-radius: 12px;">
            <table id="table">
              <thead>
                <tr>
                  <th data-key="date">Date</th>
                  <th data-key="player">Player</th>
                  <th data-key="map">Map</th>
                  <th data-key="challenge">Challenge</th>
                  <th data-key="round" title="Round reached">Round</th>
                  <th data-key="time">Time</th>
                  <th data-key="downs">Downs</th>
                  <th data-key="score">Score</th>
                  <th>Proof</th>
                  <th>Notes</th>
                  <th></th>
                </tr>
              </thead>
              <tbody id="tbody"></tbody>
            </table>
          </div>

          <p class="hint" style="margin-top:10px">Tip: Click column headers to sort. Use <span class="kbd">Export JSON</span> to share records with teammates.</p>
        </div>
      </section>
    </div>
  </main>

  <template id="row-template">
    <tr>
      <td class="date"></td>
      <td class="player"></td>
      <td class="map"></td>
      <td class="challenge"></td>
      <td class="round"></td>
      <td class="time"></td>
      <td class="downs"></td>
      <td class="score"></td>
      <td class="proof"></td>
      <td class="notes"></td>
      <td><button class="btn" data-action="edit">Edit</button> <button class="btn" data-action="delete">Delete</button></td>
    </tr>
  </template>

  <script>
    // ---------- Static Data ----------
    const PLAYERS = ["Zane","Tyler","Garrett","Andy","Matt","Jonny"];

    const CHALLENGES = [
      "NORMAL","3,2,1","Starting Room","Boom & Zoom","Perk Roulette","Powerless","Knife Only","Dont Drink","WallGuns Only","Old School","Rusty Handles","Copy Cat","Starting Weapon","Pistols Only","Box Roulette","Room Rotation","Flash Sale","Sticks & Stones"
    ];

    const MAPS = [
      "Nacht der Untoten",
      "Zombie Verrückt (Map Pack 1)",
      "Shi No Numa (Map Pack 2)",
      "Der Riese (Map Pack 3)",
      "Kino Der Toten",
      "“Five”",
      "Ascension (First Strike DLC)",
      "Call of the Dead (Escalation DLC)",
      "Shangri-La (Annihilation DLC)",
      "Moon (Rezurrection DLC)",
      "BO1 Nacht der Untoten",
      "BO1 Zombie Verrückt",
      "BO1 Shi No Numa",
      "BO1 Der Riese",
      "TranZit",
      "Bus Depot (Survival)",
      "Farm (Survival, Grief)",
      "Town (Survival, Grief)",
      "Nuketown Zombies",
      "Die Rise (Revolution DLC)",
      "Mob of the Dead (Uprising DLC)",
      "Buried (Vengeance DLC)",
      "Origins (Apocalypse DLC)",
      "Shadows of Evil",
      "The Giant",
      "Der Eisendrache (Awakening DLC)",
      "Zetsubou No Shima (Eclipse DLC)",
      "Gorod Krovi (Descent DLC)",
      "Revelations (Salvation DLC)",
      "BO3 Nacht der Untoten",
      "BO3 Verrückt",
      "BO3 Shi No Numa",
      "BO3 Kino Der Toten",
      "BO3 Ascension",
      "BO3 Shangri-La",
      "BO3 Moon",
      "BO3 Origins",
      "Voyage of Despair",
      "IX",
      "Blood of The Dead",
      "Classified",
      "Dead of the Night (DLC1)",
      "Ancient Evil (DLC2)",
      "Alpha Omega (DLC3)",
      "Tag Der Toten (DLC4)",
      "Die Maschine",
      "Firebase Z",
      "Outbreak",
      "Mauer der Toten",
      "Forsaken",
      "Terminus",
      "Liberty Falls",
      "Citadelle Des Morts",
      "The Tomb",
      "Shattered Veil",
      "Reckoning"
    ];

    // ---------- Utilities ----------
    const byId = (id) => document.getElementById(id);
    const fmtTimeToSeconds = (t) => {
      if (!t) return null;
      const parts = t.split(":").map(Number);
      if (parts.some(isNaN)) return null;
      if (parts.length === 2) { // mm:ss
        return parts[0]*60 + parts[1];
      } else if (parts.length === 3) { // hh:mm:ss
        return parts[0]*3600 + parts[1]*60 + parts[2];
      }
      return null;
    };
    const fmtSecondsToTime = (s) => {
      if (s == null) return "";
      const h = Math.floor(s / 3600);
      const m = Math.floor((s % 3600)/60);
      const sec = s % 60;
      return h ? `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(sec).padStart(2,'0')}` : `${String(m).padStart(2,'0')}:${String(sec).padStart(2,'0')}`;
    };

    const STORAGE_KEY = "zombiesRecords.v1";

    function loadRecords(){
      try{ return JSON.parse(localStorage.getItem(STORAGE_KEY)) || []; }catch{ return []; }
    }
    function saveRecords(records){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(records));
    }

    function uid(){ return Math.random().toString(36).slice(2) + Date.now().toString(36); }

    function compareBest(a,b){
      // Higher round better, then lower time, then lower downs, then newer date
      const r = (b.round||0) - (a.round||0);
      if (r!==0) return r;
      const ta = a.time_s ?? Infinity, tb = b.time_s ?? Infinity; // lower better
      if (ta !== tb) return ta - tb;
      const da = a.downs ?? Infinity, db = b.downs ?? Infinity; // lower better
      if (da !== db) return da - db;
      return (new Date(b.date||0)) - (new Date(a.date||0));
    }

    function compareRecent(a,b){ return (new Date(b.date||0)) - (new Date(a.date||0)); }
    function compareRound(a,b){ return (b.round||0) - (a.round||0); }
    function compareTime(a,b){ return (a.time_s ?? Infinity) - (b.time_s ?? Infinity); }

    // ---------- State ----------
    let RECORDS = loadRecords();
    let EDITING_ID = null;
    let CURRENT_SORT = 'best';

    // ---------- DOM Setup ----------
    function fillSelect(el, arr){
      el.innerHTML = arr.map(v => `<option value="${v}">${v}</option>`).join("");
    }

    fillSelect(byId('player'), PLAYERS);
    fillSelect(byId('map'), MAPS);
    fillSelect(byId('challenge'), CHALLENGES);

    // Filters
    fillSelect(byId('filter-map'), ["", ...MAPS]);
    fillSelect(byId('filter-challenge'), ["", ...CHALLENGES]);
    fillSelect(byId('filter-player'), ["", ...PLAYERS]);

    // Default date today
    byId('date').valueAsDate = new Date();

    // ---------- Form Submit ----------
    byId('record-form').addEventListener('submit', (e)=>{
      e.preventDefault();
      const rec = {
        id: EDITING_ID || uid(),
        player: byId('player').value,
        date: byId('date').value || null,
        map: byId('map').value,
        challenge: byId('challenge').value,
        round: Number(byId('round').value || 0),
        time: byId('time').value || "",
        time_s: fmtTimeToSeconds(byId('time').value || ""),
        downs: byId('downs').value ? Number(byId('downs').value) : null,
        score: byId('score').value ? Number(byId('score').value) : null,
        proof: byId('proof').value || "",
        notes: byId('notes').value || "",
        updatedAt: new Date().toISOString()
      };

      if (EDITING_ID){
        RECORDS = RECORDS.map(r => r.id === EDITING_ID ? rec : r);
      } else {
        RECORDS.push(rec);
      }
      saveRecords(RECORDS);
      EDITING_ID = null;
      e.target.reset();
      byId('date').valueAsDate = new Date();
      render();
    });

    byId('reset-btn').addEventListener('click', ()=>{
      EDITING_ID = null;
      byId('record-form').reset();
      byId('date').valueAsDate = new Date();
    });

    // ---------- Import / Export ----------
    byId('export-btn').addEventListener('click', ()=>{
      const dataStr = JSON.stringify(RECORDS, null, 2);
      const blob = new Blob([dataStr], {type: 'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'zombies-records.json';
      document.body.appendChild(a); a.click(); a.remove();
      URL.revokeObjectURL(url);
    });

    byId('import-file').addEventListener('change', (e)=>{
      const file = e.target.files?.[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = () => {
        try{
          const imported = JSON.parse(reader.result);
          if (!Array.isArray(imported)) throw new Error('Invalid file');
          RECORDS = imported;
          saveRecords(RECORDS);
          render();
        } catch(err){
          alert('Import failed: ' + err.message);
        }
      };
      reader.readAsText(file);
      e.target.value = '';
    });

    // ---------- Filters & Sorting ----------
    ['filter-map','filter-challenge','filter-player','filter-sort','search'].forEach(id=>{
      byId(id).addEventListener('input', ()=>{
        CURRENT_SORT = byId('filter-sort').value;
        render();
      });
    });

    // Column sort via header clicks
    document.querySelectorAll('th[data-key]').forEach(th=>{
      th.addEventListener('click', ()=>{
        const key = th.dataset.key;
        const map = {date:'recent', player:'best', map:'best', challenge:'best', round:'round', time:'time', downs:'best'};
        CURRENT_SORT = map[key] || 'best';
        byId('filter-sort').value = CURRENT_SORT;
        render();
      });
    });

    // Wipe all
    byId('wipe-btn').addEventListener('click', ()=>{
      if (confirm('This will permanently erase all saved records on this device. Continue?')){
        RECORDS = [];
        saveRecords(RECORDS);
        render();
      }
    });

    // ---------- Render ----------
    function applyFilters(list){
      const m = byId('filter-map').value;
      const c = byId('filter-challenge').value;
      const p = byId('filter-player').value;
      const q = byId('search').value.trim().toLowerCase();
      return list.filter(r => (
        (!m || r.map===m) && (!c || r.challenge===c) && (!p || r.player===p) &&
        (!q || (r.notes?.toLowerCase().includes(q) || r.proof?.toLowerCase().includes(q)))
      ));
    }

    function sortList(list){
      const l = [...list];
      switch(CURRENT_SORT){
        case 'recent': l.sort(compareRecent); break;
        case 'round': l.sort(compareRound); break;
        case 'time': l.sort(compareTime); break;
        default: l.sort(compareBest);
      }
      return l;
    }

    function render(){
      const tbody = byId('tbody');
      tbody.innerHTML = '';
      let list = applyFilters(RECORDS);
      list = sortList(list);
      byId('count').textContent = `${list.length} result${list.length===1?'':'s'}`;

      if (list.length === 0){
        const tr = document.createElement('tr');
        const td = document.createElement('td');
        td.colSpan = 11; td.className = 'empty';
        td.textContent = 'No records yet. Add one on the left!';
        tr.appendChild(td); tbody.appendChild(tr);
        return;
      }

      const tpl = byId('row-template');
      list.forEach(r => {
        const row = tpl.content.firstElementChild.cloneNode(true);
        row.querySelector('.date').textContent = r.date || '';
        row.querySelector('.player').textContent = r.player;
        row.querySelector('.map').textContent = r.map;
        row.querySelector('.challenge').innerHTML = `<span class="chip">${r.challenge}</span>`;
        row.querySelector('.round').textContent = r.round ?? '';
        row.querySelector('.time').textContent = r.time || fmtSecondsToTime(r.time_s);
        row.querySelector('.downs').textContent = r.downs ?? '';
        row.querySelector('.score').textContent = r.score ?? '';
        if (r.proof){
          const a = document.createElement('a');
          a.href = r.proof; a.target = '_blank'; a.rel = 'noopener noreferrer'; a.textContent = 'Link';
          row.querySelector('.proof').appendChild(a);
        }
        row.querySelector('.notes').textContent = r.notes || '';

        // Actions
        row.querySelector('[data-action="edit"]').addEventListener('click', ()=>{
          EDITING_ID = r.id;
          byId('player').value = r.player;
          if (r.date) byId('date').value = r.date; else byId('date').value = '';
          byId('map').value = r.map;
          byId('challenge').value = r.challenge;
          byId('round').value = r.round ?? '';
          byId('time').value = r.time || (r.time_s!=null?fmtSecondsToTime(r.time_s):'');
          byId('downs').value = r.downs ?? '';
          byId('score').value = r.score ?? '';
          byId('proof').value = r.proof || '';
          byId('notes').value = r.notes || '';
          window.scrollTo({top:0, behavior:'smooth'});
        });
        row.querySelector('[data-action="delete"]').addEventListener('click', ()=>{
          if (confirm('Delete this record?')){
            RECORDS = RECORDS.filter(x => x.id !== r.id);
            saveRecords(RECORDS);
            render();
          }
        });

        tbody.appendChild(row);
      });
    }

    render();
  </script>
</body>
</html>

